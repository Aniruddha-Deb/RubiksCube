/**
 * @preserve
 * @license
 * The MIT License (MIT)
 * 
 * Copyright (c) 2014 Cuber Authors
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
*/

var ERNO={};!function(){Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},s=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,s.prototype=new n,s})}(),ERNO.extend=function(t,e){if(Object.keys)for(var i=Object.keys(e),n=0,s=i.length;n<s;n++){var o=i[n];Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(e,o))}else{var r={}.hasOwnProperty;for(var o in e)r.call(e,o)&&(t[o]=e[o])}return t};var _={isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},cascade:function(){var t,e=Array.prototype.slice.call(arguments);for(t=0;t<e.length;t++)if(void 0!==e[t])return e[t];return!1},hexToRgb:function(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,function(t,e,i,n){return e+e+i+i+n+n});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}};ERNO.extend(Number.prototype,{absolute:function(){return Math.abs(this)},add:function(){var t=this;return Array.prototype.slice.call(arguments).forEach(function(e){t+=e}),t},arcCosine:function(){return Math.acos(this)},arcSine:function(){return Math.asin(this)},arcTangent:function(){return Math.atan(this)},constrain:function(t,e){var i,n,s=this;return e=e||0,i=Math.max(t,e),n=Math.min(t,e),s=Math.min(s,i),s=Math.max(s,n)},cosine:function(){return Math.cos(this)},degreesToDirection:function(){var t=["N","NNE","NE","NEE","E","SEE","SE","SSE","S","SSW","SW","SWW","W","NWW","NW","NNW","N"];return t[this.scale(0,360,0,t.length-1).round()]},degreesToRadians:function(){return this*Math.PI/180},divide:function(){var t=this;return Array.prototype.slice.call(arguments).forEach(function(e){t/=e}),t},isBetween:function(t,e){var i=Math.min(t,e),n=Math.max(t,e);return i<=this&&this<=n},lerp:function(t,e){return t+(e-t)*this},log:function(t){return Math.log(this)/(void 0===t?1:Math.log(t))},log10:function(){return Math.log(this)/Math.LN10},maximum:function(t){return Math.max(this,t)},minimum:function(t){return Math.min(this,t)},modulo:function(t){return(this%t+t)%t},multiply:function(){var t=this;return Array.prototype.slice.call(arguments).forEach(function(e){t*=e}),t},normalize:function(t,e){return t==e?1:(this-t)/(e-t)},raiseTo:function(t){return Math.pow(this,t)},radiansToDegrees:function(){return 180*this/Math.PI},rand:function(t){var e,i;return void 0!==t?(e=Math.min(this,t),i=Math.max(this,t),e+Math.floor(Math.random()*(i-e))):Math.floor(Math.random()*this)},random:function(t){var e,i;return void 0!==t?(e=Math.min(this,t),i=Math.max(this,t),e+Math.random()*(i-e)):Math.random()*this},remainder:function(t){return this%t},round:function(t){var e=this;return t=t||0,e*=Math.pow(10,t),e=Math.round(e),e/=Math.pow(10,t)},roundDown:function(){return Math.floor(this)},roundUp:function(){return Math.ceil(this)},scale:function(t,e,i,n){var s=this.normalize(t,e);return i==n?n:i+s*(n-i)},sine:function(){return Math.sin(this)},subtract:function(){var t=this;return Array.prototype.slice.call(arguments).forEach(function(e){t-=e}),t},tangent:function(){return Math.tan(this)},toArray:function(){return[this.valueOf()]},toNumber:function(){return this.valueOf()},toPaddedString:function(t){return("0000000000000"+String(this)).slice(-t)},toSignedString:function(){var t=""+this;return this>=0&&(t="+"+t),t},toString:function(){return""+this}}),ERNO.extend(String.prototype,{capitalize:function(){return this.charAt(0).toUpperCase()+this.slice(1)},invert:function(){var t,e="";for(t=0;t<this.length;t++)e+=this.charAt(t)===this.charAt(t).toUpperCase()?this.charAt(t).toLowerCase():this.charAt(t).toUpperCase();return e},justifyCenter:function(t){var e=Math.round(this.length/2),i=this.length-e,n=Math.round(t/2),s=t-n,o=n-e,r=s-i,a=this;if(o>0)for(;o--;)a=" "+a;else o<0&&(a=a.substr(o*-1));if(r>0)for(;r--;)a+=" ";else r<0&&(a=a.substr(0,a.length+r));return a},justifyLeft:function(t){for(var e=this;e.length<t;)e+=" ";return e},justifyRight:function(t){for(var e=this;e.length<t;)e=" "+e;return e},multiply:function(t){var e,i="";for(t=_.cascade(t,2),e=0;e<t;e++)i+=this;return i},reverse:function(){var t,e="";for(t=0;t<this.length;t++)e=this[t]+e;return e},splice:function(){var t=this.split("");return Array.prototype.splice.apply(t,arguments),t.join("")},size:function(){return this.length},toEntities:function(){var t,e="";for(t=0;t<this.length;t++)e+="&#"+this.charCodeAt(t)+";";return e},toCamelCase:function(){var t,e=this.split(/\W+|_+/),i=e[0];for(t=1;t<e.length;t++)i+=e[t].capitalize();return i},directionToDegrees:function(){var t=["N","NNE","NE","NEE","E","SEE","SE","SSE","S","SSW","SW","SWW","W","NWW","NW","NNW","N"],e=t.indexOf(this.toUpperCase());return e>=0?e.scale(0,t.length-1,0,360):Number.NaN},toArray:function(){return[this]},toNumber:function(){return parseFloat(this)},toString:function(){return this},toUnderscoreCase:function(){var t=this.replace(/[A-Z]+/g,function(t){return"_"+t});return"_"===t.charAt(0)&&(t=t.substr(1)),t.toLowerCase()},toUnicode:function(){var t,e,i="";for(t=0;t<this.length;t++){for(e=this.charCodeAt(t).toString(16).toUpperCase();e.length<4;)e="0"+e;i+="\\u"+e}return i}}),ERNO.extend(Array.prototype,{distanceTo:function(t){var e,i=0;if(arguments.length>0&&(t=Array.prototype.slice.call(arguments)),this.length===t.length){for(e=0;e<this.length;e++)i+=Math.pow(t[e]-this[e],2);return Math.pow(i,.5)}return null},first:function(){return this[0]},last:function(){return this[this.length-1]},maximum:function(){return Math.max.apply(null,this)},middle:function(){return this[Math.round((this.length-1)/2)]},minimum:function(){return Math.min.apply(null,this)},rand:function(){return this[Math.floor(Math.random()*this.length)]},random:function(){return this[Math.floor(Math.random()*this.length)]},shuffle:function(){var t,e,i,n=this,s=this.length;if(0==s)return!1;for(;--s;)t=Math.floor(Math.random()*(s+1)),e=n[s],i=n[t],n[s]=i,n[t]=e;return n},toArray:function(){return this},toHtml:function(){var t,e="<ul>";for(t=0;t<this.length;t++)e+=this[t]instanceof Array?this[t].toHtml():"<li>"+this[t]+"</li>";return e+="</ul>"},toText:function(t){var e,i,n;for(t=_.cascade(t,0),i="\n"+"\t".multiply(t),n="",e=0;e<this.length;e++)n+=this[e]instanceof Array?i+this[e].toText(t+1):i+this[e];return n}}),ERNO.Color=function(t,e,i,n,s){this.name=t,this.initial=e,this.hex=i,this.styleF=n,this.styleB=s};var W,O,B,R,G,Y,N,COLOURLESS;W=ERNO.WHITE=new ERNO.Color("white","W","#FFF","font-weight: bold; color: #888","background-color: #F3F3F3; color: rgba( 0, 0, 0, 0.5 )"),O=ERNO.ORANGE=new ERNO.Color("orange","O","#F60","font-weight: bold; color: #F60","background-color: #F60; color: rgba( 255, 255, 255, 0.9 )"),B=ERNO.BLUE=new ERNO.Color("blue","B","#00D","font-weight: bold; color: #00D","background-color: #00D; color: rgba( 255, 255, 255, 0.9 )"),R=ERNO.RED=new ERNO.Color("red","R","#F00","font-weight: bold; color: #F00","background-color: #F00; color: rgba( 255, 255, 255, 0.9 )"),G=ERNO.GREEN=new ERNO.Color("green","G","#0A0","font-weight: bold; color: #0A0","background-color: #0A0; color: rgba( 255, 255, 255, 0.9 )"),Y=ERNO.YELLOW=new ERNO.Color("yellow","Y","#FE0","font-weight: bold; color: #ED0","background-color: #FE0; color: rgba( 0, 0, 0, 0.5 )"),N=ERNO.GRAY=new ERNO.Color("gray","N","#888","font-weight: bold; color: #888","background-color: #888; color: rgba( 0, 0, 0, 0.5 )"),ERNO.COLORLESS=new ERNO.Color("NA","X","#DDD","color: #EEE","color: #DDD"),ERNO.Direction=function(t,e,i){this.id=t,this.name=e.toLowerCase(),this.normal=i,this.initial=e.substr(0,1).toUpperCase(),this.neighbors=[],this.opposite=null},ERNO.Direction.prototype.setRelationships=function(t,e,i,n,s){this.neighbors=[t,e,i,n],this.opposite=s},ERNO.Direction.getNameById=function(t){return["front","up","right","down","left","back"][t]},ERNO.Direction.getIdByName=function(t){return{front:0,up:1,right:2,down:3,left:4,back:5}[t]},ERNO.Direction.getDirectionById=function(t){return[ERNO.Direction.FRONT,ERNO.Direction.UP,ERNO.Direction.RIGHT,ERNO.Direction.DOWN,ERNO.Direction.LEFT,ERNO.Direction.BACK][t]},ERNO.Direction.getDirectionByInitial=function(t){return{F:ERNO.Direction.FRONT,U:ERNO.Direction.UP,R:ERNO.Direction.RIGHT,D:ERNO.Direction.DOWN,L:ERNO.Direction.LEFT,B:ERNO.Direction.BACK}[t.toUpperCase()]},ERNO.Direction.getDirectionByName=function(t){return{front:ERNO.Direction.FRONT,up:ERNO.Direction.UP,right:ERNO.Direction.RIGHT,down:ERNO.Direction.DOWN,left:ERNO.Direction.LEFT,back:ERNO.Direction.BACK}[t.toLowerCase()]},ERNO.Direction.getDirectionByNormal=function(){var t=new THREE.Vector3;return function(e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t.equals(ERNO.Direction.FRONT.normal)?ERNO.Direction.FRONT:t.equals(ERNO.Direction.BACK.normal)?ERNO.Direction.BACK:t.equals(ERNO.Direction.UP.normal)?ERNO.Direction.UP:t.equals(ERNO.Direction.DOWN.normal)?ERNO.Direction.DOWN:t.equals(ERNO.Direction.LEFT.normal)?ERNO.Direction.LEFT:t.equals(ERNO.Direction.RIGHT.normal)?ERNO.Direction.RIGHT:null}}(),ERNO.Direction.prototype.getRotation=function(t,e,i){if(void 0===e&&(e=this.neighbors[0]),e===this||e===this.opposite)return null;i=void 0===i?1:i.modulo(4);for(var n=0;n<5&&this.neighbors[n]!==e;n++);return this.neighbors[n.add(i*t).modulo(4)]},ERNO.Direction.prototype.getClockwise=function(t,e){return this.getRotation(1,t,e)},ERNO.Direction.prototype.getAnticlockwise=function(t,e){return this.getRotation(-1,t,e)},ERNO.Direction.prototype.getDirection=function(t,e){return this.getRotation(1,e,t.id-1)},ERNO.Direction.prototype.getUp=function(t){return this.getDirection(ERNO.Direction.UP,t)},ERNO.Direction.prototype.getRight=function(t){return this.getDirection(ERNO.Direction.RIGHT,t)},ERNO.Direction.prototype.getDown=function(t){return this.getDirection(ERNO.Direction.DOWN,t)},ERNO.Direction.prototype.getLeft=function(t){return this.getDirection(ERNO.Direction.LEFT,t)},ERNO.Direction.prototype.getOpposite=function(){return this.opposite},ERNO.Direction.FRONT=new ERNO.Direction(0,"front",new THREE.Vector3(0,0,1)),ERNO.Direction.UP=new ERNO.Direction(1,"up",new THREE.Vector3(0,1,0)),ERNO.Direction.RIGHT=new ERNO.Direction(2,"right",new THREE.Vector3(1,0,0)),ERNO.Direction.DOWN=new ERNO.Direction(3,"down",new THREE.Vector3(0,-1,0)),ERNO.Direction.LEFT=new ERNO.Direction(4,"left",new THREE.Vector3(-1,0,0)),ERNO.Direction.BACK=new ERNO.Direction(5,"back",new THREE.Vector3(0,0,-1)),ERNO.Direction.FRONT.setRelationships(ERNO.Direction.UP,ERNO.Direction.RIGHT,ERNO.Direction.DOWN,ERNO.Direction.LEFT,ERNO.Direction.BACK),ERNO.Direction.UP.setRelationships(ERNO.Direction.BACK,ERNO.Direction.RIGHT,ERNO.Direction.FRONT,ERNO.Direction.LEFT,ERNO.Direction.DOWN),ERNO.Direction.RIGHT.setRelationships(ERNO.Direction.UP,ERNO.Direction.BACK,ERNO.Direction.DOWN,ERNO.Direction.FRONT,ERNO.Direction.LEFT),ERNO.Direction.DOWN.setRelationships(ERNO.Direction.FRONT,ERNO.Direction.RIGHT,ERNO.Direction.BACK,ERNO.Direction.LEFT,ERNO.Direction.UP),ERNO.Direction.LEFT.setRelationships(ERNO.Direction.UP,ERNO.Direction.FRONT,ERNO.Direction.DOWN,ERNO.Direction.BACK,ERNO.Direction.RIGHT),ERNO.Direction.BACK.setRelationships(ERNO.Direction.UP,ERNO.Direction.LEFT,ERNO.Direction.DOWN,ERNO.Direction.RIGHT,ERNO.Direction.FRONT),ERNO.Queue=function(t){void 0!==t&&t instanceof Function&&(this.validate=t),this.history=[],this.useHistory=!0,this.future=[],this.isReady=!0,this.isLooping=!1},ERNO.Queue.prototype.add=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this.validate&&this.validate instanceof Function&&(t=this.validate(t)),t instanceof Array&&t.forEach(function(t){this.future.push(t)}.bind(this)),this.future},ERNO.Queue.prototype.remove=function(){var t=Array.prototype.slice.call(arguments);return t instanceof Array&&t.forEach(function(t){this.future=this.future.filter(function(e){return e!=t})}.bind(this)),this.future},ERNO.Queue.prototype.purge=function(){var t=Array.prototype.slice.call(arguments);return t instanceof Array&&t.forEach(function(t){this.history=this.history.filter(function(e){return e!=t})}.bind(this)),this.history},ERNO.Queue.prototype.empty=function(t){this.future=[],t&&(this.history=[])},ERNO.Queue.prototype.do=function(){if(this.future.length){var t=this.future.shift();return this.useHistory&&this.history.push(t),t}this.isLooping&&(this.future=this.history.slice(),this.history=[])},ERNO.Queue.prototype.undo=function(){if(this.history.length){var t=this.history.pop();return this.future.unshift(t),t}},ERNO.Queue.prototype.redo=function(){return this.do()},ERNO.Twist=function(t,e){t&&this.set(t,e)},ERNO.Twist.prototype.set=function(t,e){var i={X:"Cube on X",L:"Left face",M:"Middle slice",R:"Right face",Y:"Cube on Y",U:"Up face",E:"Equator slice",D:"Down face",Z:"Cube on Z",F:"Front face",S:"Standing slice",B:"Back face",A:"Double Left face",C:"Double Right face",G:"Double Up face",H:"Double Down face",I:"Double Front face",J:"Double Back face"}[t.toUpperCase()];if(void 0===i)return!1;void 0!=e&&e<0&&(t=t.invert(),e=e.absolute());var n=0,s="unwise";t===t.toUpperCase()?(n=1,s="clockwise"):t===t.toLowerCase()&&(n=-1,s="anticlockwise"),this.command=t,this.group=i,this.degrees=e,this.vector=n,this.wise=s,this.isShuffle=!1,this.getInverse=function(){return new ERNO.Twist(t.invert(),e)}},ERNO.Twist.prototype.equals=function(t){return this.command===t.command&&this.degrees===t.degrees},ERNO.Twist.prototype.copy=function(t){return this.command=t.command,this.group=t.group,this.degrees=t.degrees,this.vector=t.vector,this.wise=t.wise,this.isShuffle=t.isShuffle,this},ERNO.Twist.validate=function(){var t,e,i,n,s,o,r,a,c,h=Array.prototype.slice.call(arguments);for(e=0;e<h.length;e++)if(t=h[e],i=e+1<h.length?h[e+1]:void 0,t instanceof ERNO.Twist);else if("string"==typeof t){if(1===t.length)"number"==typeof i?h[e]=new ERNO.Twist(t,i):h[e]=new ERNO.Twist(t);else if(t.length>1){for(n=/(-?\d+|[XLMRYUEDZFSBTACGHIJ])/gi,s=t.match(n),r=0;r<s.length;r++)o=s[r],_.isNumeric(o)?s[r]=+o:(a=s.slice(0,r),c=s.slice(r+1),o=o.split(""),s=a.concat(o,c));a=h.slice(0,e),c=h.slice(e+1),h=a.concat(s,c),e--}}else t instanceof ERNO.Direction?(h[e]=t.initial,e--):t instanceof Array?(a=h.slice(0,e),c=h.slice(e+1),h=a.concat(t,c),e--):(h.splice(e,1),e--);return h},ERNO.Cubelet=function(t,e,i){THREE.Object3D.call(this),this.cube=t,this.cubeletId=e||0,this.setAddress(this.cubeletId),this.size=t.cubeletSize||140;var n=.1,s=this.addressX*(this.size+n),o=this.addressY*(this.size+n),r=this.addressZ*(this.size+n);this.position.set(s,o,r),this.matrixSlice=(new THREE.Matrix4).makeTranslation(s,o,r),this.updateMatrix(),this.cube.object3D.add(this);var a=0;void 0===i&&(i=[W,O,,,G]),this.faces=[];for(var c=0;c<6;c++){var h=i[c]||ERNO.COLORLESS;this.faces[c]={},this.faces[c].id=c,this.faces[c].color=h,this.faces[c].normal=ERNO.Direction.getNameById(c),this.faces[c].isIntrovert=h===ERNO.COLORLESS,h===ERNO.COLORLESS||a++}this.type=["core","center","edge","corner"][a],this.front=this.faces[0],this.up=this.faces[1],this.right=this.faces[2],this.down=this.faces[3],this.left=this.faces[4],this.back=this.faces[5],this.colors=(this.faces[0].color?this.faces[0].color.initial:"-")+(this.faces[1].color?this.faces[1].color.initial:"-")+(this.faces[2].color?this.faces[2].color.initial:"-")+(this.faces[3].color?this.faces[3].color.initial:"-")+(this.faces[4].color?this.faces[4].color.initial:"-")+(this.faces[5].color?this.faces[5].color.initial:"-"),this.isStickerCubelet=this.front.color&&"white"===this.front.color.name&&"center"===this.type,this.isTweening=!0,this.isEngagedX=!1,this.isEngagedY=!1,this.isEngagedZ=!1,this.isTweening=!1,this.opacity=1,this.radius=0},ERNO.Cubelet.prototype=Object.create(THREE.Object3D.prototype),ERNO.extend(ERNO.Cubelet.prototype,{setAddress:function(t){this.address=t||0,this.addressX=t.modulo(3).subtract(1),this.addressY=t.modulo(9).divide(3).roundDown().subtract(1)*-1,this.addressZ=t.divide(9).roundDown().subtract(1)*-1},hasColor:function(t){var e,i,n,s=_.hexToRgb(t.hex);for(e=0;e<6;e++)if(n=_.hexToRgb(this.faces[e].color.hex),n.r===s.r&&n.g===s.g&&n.b===s.b){i=e;break}return void 0!==i&&["front","up","right","down","left","back"][i]},hasColors:function(){var t=this,e=!0,i=Array.prototype.slice.call(arguments);return i.forEach(function(i){e=e&&!!t.hasColor(i)}),e},getRadius:function(){return this.radius},setRadius:function(t,e){if(this.isTweening===!1&&(t=t||0,void 0===this.radius&&(this.radius=0),this.radius!==t)){this.isTweening=!0;var i=(this.radius-t).absolute(),n={radius:this.radius};new TWEEN.Tween(n).to({radius:t},i).easing(TWEEN.Easing.Quartic.Out).onUpdate(function(){this.position.set(this.addressX.multiply(this.size+n.radius)+.2,this.addressY.multiply(this.size+n.radius)+.2,this.addressZ.multiply(this.size+n.radius)+.2),this.updateMatrix(),this.matrixSlice.copy(this.matrix),this.radius=n.radius}.bind(this)).onComplete(function(){this.isTweening=!1,this.position.set(this.addressX.multiply(this.size+n.radius)+.2,this.addressY.multiply(this.size+n.radius)+.2,this.addressZ.multiply(this.size+n.radius)+.2),this.updateMatrix(),this.matrixSlice.copy(this.matrix),this.radius=n.radius,e instanceof Function&&e()}.bind(this)).start(this.cube.time)}}}),ERNO.Group=function(){this.cubelets=[],this.add(Array.prototype.slice.call(arguments))},ERNO.extend(ERNO.Group.prototype,THREE.EventDispatcher.prototype),ERNO.extend(ERNO.Group.prototype,{add:function(){var t=Array.prototype.slice.call(arguments),e=this;return t.forEach(function(t){t instanceof ERNO.Group&&(t=t.cubelets),t instanceof Array?e.add.apply(e,t):e.cubelets.push(t)}),this},remove:function(t){if(t instanceof ERNO.Group&&(t=t.cubelets),t instanceof Array){var e=this;t.forEach(function(t){e.remove(t)})}for(var i=this.cubelets.length;i-- >0;)this.cubelets[i]===t&&this.cubelets.splice(i,1);return this},isFlagged:function(t){var e=0;return this.cubelets.forEach(function(i){e+=i[t]?1:0}),e},isTweening:function(){return this.isFlagged("isTweening")},isEngagedX:function(){return this.isFlagged("isEngagedX")},isEngagedY:function(){return this.isFlagged("isEngagedY")},isEngagedZ:function(){return this.isFlagged("isEngagedZ")},isEngaged:function(){return this.isEngagedX()+this.isEngagedY()+this.isEngagedZ()},hasProperty:function(t,e){var i=new ERNO.Group;return this.cubelets.forEach(function(n){n[t]===e&&i.add(n)}),i},hasId:function(t){return this.hasProperty("id",t)},hasAddress:function(t){return this.hasProperty("address",t)},hasType:function(t){return this.hasProperty("type",t)},hasColor:function(t){var e=new ERNO.Group;return this.cubelets.forEach(function(i){i.hasColor(t)&&e.add(i)}),e},hasColors:function(){var t=new ERNO.Group,e=Array.prototype.slice.call(arguments);return this.cubelets.forEach(function(i){i.hasColors.apply(i,e)&&t.add(i)}),t},isSolved:function(t){if(t){var e={},i=0;return t instanceof ERNO.Direction&&(t=t.name),this.cubelets.forEach(function(n){var s=n[t].color.name;void 0===e[s]?(e[s]=1,i++):e[s]++}),1===i}return console.warn("A face [String or ERNO.Controls] argument must be specified when using ERNO.Group.isSolved()."),!1},show:function(){return this.cubelets.forEach(function(t){t.show()}),this},hide:function(){return this.cubelets.forEach(function(t){t.hide()}),this},showPlastics:function(){return this.cubelets.forEach(function(t){t.showPlastics()}),this},hidePlastics:function(){return this.cubelets.forEach(function(t){t.hidePlastics()}),this},showExtroverts:function(){return this.cubelets.forEach(function(t){t.showExtroverts()}),this},hideExtroverts:function(){return this.cubelets.forEach(function(t){t.hideExtroverts()}),this},showIntroverts:function(t,e){return this.cubelets.forEach(function(i){i.showIntroverts(t,e)}),this},hideIntroverts:function(t,e){return this.cubelets.forEach(function(i){i.hideIntroverts(t,e)}),this},showStickers:function(){return this.cubelets.forEach(function(t){t.showStickers()}),this},hideStickers:function(){return this.cubelets.forEach(function(t){t.hideStickers()}),this},showWireframes:function(){return this.cubelets.forEach(function(t){t.showWireframes()}),this},hideWireframes:function(){return this.cubelets.forEach(function(t){t.hideWireframes()}),this},showIds:function(){return this.cubelets.forEach(function(t){t.showIds()}),this},hideIds:function(){return this.cubelets.forEach(function(t){t.hideIds()}),this},showTexts:function(){return this.cubelets.forEach(function(t){t.showTexts()}),this},hideTexts:function(){return this.cubelets.forEach(function(t){t.hideTexts()}),this},getOpacity:function(){var t=0;return this.cubelets.forEach(function(e){t+=e.getOpacity()}),t/this.cubelets.length},setOpacity:function(t,e){return this.cubelets.forEach(function(i){i.setOpacity(t,e)}),this},getRadius:function(){var t=0;return this.cubelets.forEach(function(e){t+=e.getRadius()}),t/this.cubelets.length},setRadius:function(t,e){return this.cubelets.forEach(function(i){i.setRadius(t,e)}),this}}),ERNO.Slice=function(t,e){this.axis=new THREE.Vector3,this.invertedAxis=new THREE.Vector3,this.matrix=new THREE.Matrix4,this.axis.rotation=0,this.indices=t,this.neighbour=null,this.ableToHideInternalFaces=!0,this.cube=e;this.getCubelet=function(i){return e.cubelets[t[i]]},this.rotateGroupMappingOnAxis=function(){var i,n=new THREE.Vector3,s=new THREE.Vector3(1,1,1),o=new THREE.Vector3,r=new THREE.Vector3,a=new THREE.Matrix4;return function(c){c=Math.round(c/(.25*Math.PI))*Math.PI*.25,n.copy(s),n.sub(this.axis);var h=e.cubelets.slice();a.makeRotationAxis(this.axis,c*-1);for(var u,l=t.length;l-- >0;){u=e.cubelets[t[l]],o.set(u.addressX,u.addressY,u.addressZ),r.copy(o),o.multiply(n).applyMatrix4(a),o.x=Math.round(o.x),o.y=Math.round(o.y),o.z=Math.round(o.z),o.add(r.multiply(this.axis)),o.add(s),o.y=2-o.y,o.z=2-o.z;var d=9*o.z+3*o.y+o.x;e.cubelets[u.address]=h[d]}for(l=0;l<e.cubelets.length;l++)e.cubelets[l].setAddress(l);a.makeRotationAxis(this.axis,c),this.cubelets.forEach(function(t){i=[],t.faces.forEach(function(t,e){o.copy(ERNO.Direction.getDirectionByName(t.normal).normal),o.applyMatrix4(a),i[ERNO.Direction.getDirectionByNormal(o).id]=t,t.normal=ERNO.Direction.getDirectionByNormal(o).name}),t.faces=i.slice(),t.front=t.faces[0],t.up=t.faces[1],t.right=t.faces[2],t.down=t.faces[3],t.left=t.faces[4],t.back=t.faces[5]})}}(),this.map()},ERNO.Slice.prototype=Object.create(ERNO.Group.prototype),ERNO.extend(ERNO.Slice.prototype,{get origin(){return this.cube.cubelets[this.indices[4]]},get north(){return this.cube.cubelets[this.indices[1]]},get northEast(){return this.cube.cubelets[this.indices[2]]},get east(){return this.cube.cubelets[this.indices[5]]},get southEast(){return this.cube.cubelets[this.indices[8]]},get south(){return this.cube.cubelets[this.indices[7]]},get southWest(){return this.cube.cubelets[this.indices[6]]},get west(){return this.cube.cubelets[this.indices[3]]},get northWest(){return this.cube.cubelets[this.indices[0]]},get cubelets(){for(var t=[],e=this.indices.length;e-- >0;)t.push(this.getCubelet(e));return t},map:function(t,e){for(var i=0;i<6;i++)if(this.origin.faces[i].color&&this.origin.faces[i].color!==ERNO.COLORLESS){this.color=this.origin.faces[i].color,this.face=ERNO.Direction.getNameById(i);break}if(void 0===this.axis||0===this.axis.lengthSq()){var n=this.northEast.position.clone(),s=this.southWest.position.clone(),o=this.northWest.position.clone();this.axis=(new THREE.Vector3).crossVectors(s.sub(n),o.sub(n)).normalize(),this.axis.rotation=0}this.up=new ERNO.Group(this.northWest,this.north,this.northEast),this.equator=new ERNO.Group(this.west,this.origin,this.east),this.down=new ERNO.Group(this.southWest,this.south,this.southEast),this.left=new ERNO.Group(this.northWest,this.west,this.southWest),this.middle=new ERNO.Group(this.north,this.origin,this.south),this.right=new ERNO.Group(this.northEast,this.east,this.southEast);var r=this.hasType("center");return r&&1===r.cubelets.length?(this.center=this.hasType("center"),this.corners=new ERNO.Group(this.hasType("corner")),this.cross=new ERNO.Group(this.center,this.hasType("edge")),this.ex=new ERNO.Group(this.center,this.hasType("corner"))):this.centers=new ERNO.Group(this.hasType("center")),this.edges=new ERNO.Group(this.hasType("edge")),this.ring=new ERNO.Group(this.northWest,this.north,this.northEast,this.west,this.east,this.southWest,this.south,this.southEast),this.dexter=new ERNO.Group(this.northWest,this.origin,this.southEast),this.sinister=new ERNO.Group(this.northEast,this.origin,this.southWest),this},set rotation(t){if(this.ableToHideInternalFaces&&0!==this.cube.isFlagged("showingIntroverts")&&this.cube.hideInvisibleFaces){var e=t%(.5*Math.PI)!==0;this.invertedAxis.copy(this.axis).negate(),e?this.neighbour?(this.showIntroverts(this.axis,!0),this.neighbour.showIntroverts(this.invertedAxis,!0)):(this.cube.showIntroverts(this.axis,!0),this.cube.showIntroverts(this.invertedAxis,!0)):this.neighbour?(this.hideIntroverts(null,!0),this.neighbour.hideIntroverts(null,!0)):this.cube.hideIntroverts(null,!0)}this.matrix.makeRotationAxis(this.axis,t),this.axis.rotation=t;for(var i,n=this.indices.length,s=new THREE.Matrix4;n--;)i=this.getCubelet(n),i.matrix.multiplyMatrices(this.matrix,i.matrixSlice),i.position.setFromMatrixPosition(i.matrix),i.scale.setFromMatrixScale(i.matrix),s.extractRotation(i.matrix),i.quaternion.setFromRotationMatrix(s)},get rotation(){return this.axis.rotation},getLocation:function(t){return t===this.origin?"origin":t===this.north?"north":t===this.northEast?"northEast":t===this.east?"east":t===this.southEast?"southEast":t===this.south?"south":t===this.southWest?"southWest":t===this.west?"west":t===this.northWest&&"northWest"},isSolved:function(t){if(t){var e,i,n={},s=this.indices.length,o=0;for(t instanceof ERNO.Direction&&(t=t.name);s-- >0;)e=this.getCubelet(s),i=e[t].color.name,void 0===n[i]?(n[i]=1,o++):n[i]++;return 1===o}return console.warn("A face [String or ERNO.Controls] argument must be specified when using ERNO.Group.isSolved()."),!1}}),ERNO.Fold=function(t,e){this.map=[t.northWest[t.face].text,t.north[t.face].text,t.northEast[t.face].text,e.northWest[e.face].text,e.north[e.face].text,e.northEast[e.face].text,t.west[t.face].text,t.origin[t.face].text,t.east[t.face].text,e.west[e.face].text,e.origin[e.face].text,e.east[e.face].text,t.southWest[t.face].text,t.south[t.face].text,t.southEast[t.face].text,e.southWest[e.face].text,e.south[e.face].text,e.southEast[e.face].text]},ERNO.Fold.prototype.getText=function(){var t="";return this.map.forEach(function(e){t+=e.innerHTML}),t},ERNO.Fold.prototype.setText=function(t){var e;for(t=t.justifyLeft(18),e=0;e<18;e++)this.map[e].innerHTML=t.substr(e,1)},ERNO.Projector=function(){return function(t,e){function i(t,e){return m.getInverse(e.projectionMatrix),c.multiplyMatrices(e.matrixWorld,m),t.applyMatrix4(c)}function n(t){var e=t!==document?t.getBoundingClientRect():{left:0,top:0,width:window.innerWidth,height:window.innerHeight};if(t!==document){var i=t.ownerDocument.documentElement;e.left+=window.pageXOffset-i.clientLeft,e.top+=window.pageYOffset-i.clientTop}return e}function s(s,o,r){return a=n(e),u.x=(o-a.left)/a.width*2-1,u.y=(r-a.top)/a.height*-2+1,u.z=-1,l.set(u.x,u.y,1),i(u,s),i(l,s),l.sub(u).normalize(),f.set(u,l),h.getInverse(t.matrixWorld),f.applyMatrix4(h),f}function o(e,i){var n=i||new THREE.Vector3;return n.copy(e).set(Math.round(n.x),Math.round(n.y),Math.round(n.z)).multiplyScalar(2/t.size).set(0|n.x,0|n.y,0|n.z),d}var r,a,c=new THREE.Matrix4,h=new THREE.Matrix4,u=new THREE.Vector3,l=new THREE.Vector3(1,1,1),d=new THREE.Vector3,f=new THREE.Ray,E=new THREE.Box3,p=new THREE.Sphere,m=new THREE.Matrix4,g=u.distanceTo(l);return E.min.set(.5*-t.size,.5*-t.size,.5*-t.size),E.max.set(.5*t.size,.5*t.size,.5*t.size),p.radius=g*t.size*.5,r={getIntersection:function(t,e,i,n,r){var a=n||new THREE.Vector3;return null===e||null===i?null:(s(t,e,i),f.intersectsSphere(p)&&null!==f.intersectBox(E,a)?(r&&(o(a,d),r.setFromNormalAndCoplanarPoint(d,a)),a):null)},getIntersectionOnPlane:function(t,e,i,n,o){return null===e||null===i?null:(s(t,e,i),f.intersectPlane(n,o))},getCubeletAtIntersection:function(){var e=new THREE.Vector3;return function(i){return e.copy(i).add(E.max).multiplyScalar(3/t.size).set(Math.min(0|e.x,2),Math.min(3-e.y|0,2),Math.min(3-e.z|0,2)),t.cubelets[9*e.z+3*e.y+e.x]}}()}}}(),ERNO.Interaction=function(){return function(t,e,i,n,s){function o(t){var e=Math.max(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z));return t.x=t.x/e|0,t.y=1===t.x?0:t.y/e|0,t.z=1===t.x||1===t.y?0:t.z/e|0,t}function r(n){D.enabled&&2!==n.button&&(f=(n.touches&&n.touches[0]||n).clientX,E=(n.touches&&n.touches[0]||n).clientY,(h=p.getIntersection(e,f,E,m,w))&&(null!==n.touches&&n.preventDefault(),0===t.isTweening()&&(T="undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),D.active=!0,u=p.getCubeletAtIntersection(m),l=[t.slices[u.addressX+1],t.slices[u.addressY+4],t.slices[u.addressZ+7]],i.addEventListener("mousemove",a),i.addEventListener("touchmove",a),i.addEventListener("mouseup",c),i.addEventListener("touchcancel",c),i.addEventListener("touchend",c),i.removeEventListener("mousedown",r),i.removeEventListener("touchstart",r))))}function a(t){D.active&&(v.x=(t.touches&&t.touches[0]||t).clientX,v.y=(t.touches&&t.touches[0]||t).clientY),D.enabled&&(t.preventDefault(),t.stopImmediatePropagation())}function c(e){var n=(e.touches&&e.touches[0]||e).clientX,s=(e.touches&&e.touches[0]||e).clientY;if(D.active=!1,D.enabled&&(n!==E||s!==E)&&R){null!==e.touches&&e.preventDefault();var o=d.name[0].toUpperCase(),h=Math.round(y/Math.PI*.5*4)*Math.PI*.5,u=O.length()/(("undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now())-T);u>.3&&(h=Math.floor(y/Math.PI*.5*4)*Math.PI*.5,h+=b.dot(O.normalize())>0?.5*Math.PI:0),t.twist(new ERNO.Twist(o,h.radiansToDegrees()))}T=0,v.x=void 0,v.y=void 0,R=!1,d=null,i.removeEventListener("mousemove",a),i.removeEventListener("touchmove",a),i.removeEventListener("mouseup",c),i.removeEventListener("touchend",c),i.removeEventListener("touchcancel",c),i.addEventListener("mousedown",r),i.addEventListener("touchstart",r)}var h,u,l,d,f,E,p=new ERNO.Projector(t,i),m=new THREE.Vector3,g=new THREE.Vector3,R=!1,w=new THREE.Plane,O=new THREE.Vector3,b=new THREE.Vector3,v=new THREE.Vector2,N=(new THREE.Vector3,new THREE.Vector3),y=0,T=0;v.x=void 0,v.y=void 0;var D={};Object.assign(D,THREE.EventDispatcher.prototype,{active:!1,enabled:!0,multiDrag:s||!1,multiDragSnapArea:100,dragSpeed:n||1.3}),D.getIntersectionAt=function(){var t=new THREE.Vector3,i=new THREE.Plane;return function(n,s){return null===p.getIntersection(e,n,s,t,i)?null:{cubelet:p.getCubeletAtIntersection(t),face:1===i.normal.x?"RIGHT":i.normal.x===-1?"LEFT":1===i.normal.y?"UP":i.normal.y===-1?"DOWN":1===i.normal.z?"FRONT":"BACK"}}}();D.update=function(){var i=v.x,n=v.y;if(D.enabled&&D.active&&void 0!==i&&void 0!=n&&(f!==i||E!==n)){if(p.getIntersectionOnPlane(e,i,n,w,g),O.subVectors(g,m),!R&&O.length()>5&&(d&&(d.rotation=0),R=!0,N.crossVectors(w.normal,O),o(N),d=l[Math.abs(3*N.z+2*N.y+N.x)-1],b.crossVectors(d.axis,w.normal).normalize()),R){O.subVectors(g,m);var s=b.dot(O);y=s/t.size*D.dragSpeed}d&&(d.rotation=y)}},i.addEventListener("mousedown",r),i.addEventListener("touchstart",r);var x,S,C=function(t,e){var i=this.getIntersectionAt(t,e);return!!i&&(this.dispatchEvent({type:"click",cubelet:i.cubelet,face:i.face}),!0)}.bind(D);return i.addEventListener("mousedown",function(t){x=t.clientX,S=t.clientY}),i.addEventListener("mouseup",function(t){var e=t.clientX,i=t.clientY;!R&&Math.abs(Math.sqrt((e-x)*(e-x)+(i-S)*(i-S)))<10*(window.devicePixelratio||1)&&C(x,S)}),i.addEventListener("touchstart",function(t){x=t.touches[0].clientX,S=t.touches[0].clientY}),i.addEventListener("touchend",function(t){
var e=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY;!R&&Math.abs(Math.sqrt((e-x)*(e-x)+(i-S)*(i-S)))<10*(window.devicePixelratio||1)&&C(x,S)&&t.preventDefault()}),D}}(),ERNO.Controls=function(){function t(t){var e=t!==document?t.getBoundingClientRect():{left:0,top:0,width:window.innerWidth,height:window.innerHeight};return e}var e={NONE:-1,ROTATE:0,INERTIA:1};return function(i,n,s){function o(t){m.enabled&&1===t.which&&null===p.getIntersection(n,t.pageX,t.pageY)&&(l=e.ROTATE,d.multiplyScalar(0),g(t.pageX,t.pageY,f),E.copy(f),m.domElement.removeEventListener("mousedown",o),document.addEventListener("mousemove",r),document.addEventListener("mouseup",a))}function r(t){m.enabled&&(t.preventDefault(),l=e.ROTATE,g(t.pageX,t.pageY,f),d.subVectors(f,E),E.copy(f))}function a(t){document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a),m.domElement.addEventListener("mousedown",o),m.enabled&&(l=e.INERTIA)}function c(t){m.enabled&&null===p.getIntersection(n,t.touches[0].pageX,t.touches[0].pageY)&&(l=e.ROTATE,d.multiplyScalar(0),g(t.touches[0].pageX,t.touches[0].pageY,f),E.copy(f),m.domElement.removeEventListener("touchstart",c),document.addEventListener("touchend",u),document.addEventListener("touchmove",h))}function h(t){m.enabled&&(l=e.ROTATE,g(t.changedTouches[0].pageX,t.changedTouches[0].pageY,f),d.subVectors(f,E),E.copy(f))}function u(t){document.removeEventListener("touchend",u),document.removeEventListener("touchmove",h),m.domElement.addEventListener("touchstart",c),m.enabled&&(l=e.INERTIA)}var l=e.NONE,d=new THREE.Vector2,f=new THREE.Vector2,E=(new THREE.Vector2,new THREE.Vector2),p=new ERNO.Projector(i,s),m={enabled:!0,domElement:s,rotationSpeed:4,damping:.25},g=function(e,i,n){var s=t(m.domElement),o=(s.height/s.width,window.devicePixelRatio||1);return e*=o,i*=o,n.set(.001*(e-s.width-s.left),.001*(s.height+s.top-i))};return m.update=function(){var t=new THREE.Vector3,s=0,o=new THREE.Matrix4;return function(){m.enabled!==!1&&l!==e.NONE&&(t.set(d.y,d.x*-1,0).normalize(),o.getInverse(i.matrixWorld),o.multiply(n.matrixWorld),t.transformDirection(o),d.multiplyScalar(1-Math.max(0,Math.min(1,m.damping))),s=d.length(),i.object3D.rotateOnAxis(t,-s*m.rotationSpeed),l===e.ROTATE?l=e.NONE:l===e.INERTIA&&s>=1e-4?f.add(d):l=e.NONE)}}(),m.domElement.addEventListener("mousedown",o),m.domElement.addEventListener("touchstart",c),m}}(),ERNO.Cube=function(t){ERNO.Group.call(this),t=t||{},this.paused=void 0!==t.paused&&t.paused,this.autoRotate=void 0!==t.autoRotate&&t.autoRotate,this.keyboardControlsEnabled=void 0===t.keyboardControlsEnabled||t.keyboardControlsEnabled,this.mouseControlsEnabled=void 0===t.mouseControlsEnabled||t.mouseControlsEnabled;var e=t.renderer||ERNO.renderers.CSS3D;t.textureSize=void 0===t.textureSize?120:t.textureSize,this.isShuffling=!1,this.isReady=!0,this.isSolving=!1,this.undoing=!1,this.render=!0,this.finalShuffle=null,this.hideInvisibleFaces=void 0!==t.hideInvisibleFaces&&t.hideInvisibleFaces,this.time=0,this.moveCounter=0,this.taskQueue=new ERNO.Queue,this.twistQueue=new ERNO.Queue(ERNO.Twist.validate),this.historyQueue=new ERNO.Queue(ERNO.Twist.validate),this.twistDuration=void 0!==t.twistDuration?t.twistDuration:500,this.shuffleMethod=this.PRESERVE_LOGO,this.size=3*t.textureSize,this.cubeletSize=this.size/3;var i=35,n=window.innerWidth,s=window.innerHeight,o=n/s,r=1,a=6e3;this.camera=new THREE.PerspectiveCamera(i,o,r,a),this.camera.position.z=4*this.size,this.object3D=new THREE.Object3D,this.autoRotateObj3D=new THREE.Object3D,this.rotation=this.object3D.rotation,this.quaternion=this.object3D.quaternion,this.position=this.object3D.position,this.matrix=this.object3D.matrix,this.matrixWorld=this.object3D.matrixWorld,this.rotation.set(25*Math.PI/180,-30*Math.PI/180,0),this.rotationDelta=new THREE.Euler(.1*Math.PI/180,.15*Math.PI/180,0),this.cubelets=[],(void 0===t.cubeletColorMap?[[W,O,,,G],[W,O,,,,],[W,O,B,,,],[W,,,,G],[W,,,,,],[W,,B,,,],[W,,,R,G],[W,,,R,,],[W,,B,R,,],[,O,,,G],[,O,,,,],[,O,B,,,],[,,,,G],[,,,,,],[,,B,,,],[,,,R,G],[,,,R,,],[,,B,R,,],[,O,,,G,Y],[,O,,,,Y],[,O,B,,,Y],[,,,,G,Y],[,,,,,Y],[,,B,,,Y],[,,,R,G,Y],[,,,R,,Y],[,,B,R,,Y]]:t.cubeletColorMap).forEach(function(t,e){this.cubelets.push(new ERNO.Cubelet(this,e,t))}.bind(this));this.core=new ERNO.Group,this.centers=new ERNO.Group,this.edges=new ERNO.Group,this.corners=new ERNO.Group,this.crosses=new ERNO.Group,this.cubelets.forEach(function(t,e){"core"===t.type&&this.core.add(t),"center"===t.type&&this.centers.add(t),"edge"===t.type&&this.edges.add(t),"corner"===t.type&&this.corners.add(t),"center"!==t.type&&"edge"!==t.type||this.crosses.add(t)}.bind(this)),this.left=new ERNO.Slice([24,21,18,15,12,9,6,3,0],this),this.left.name="left",this.middle=new ERNO.Slice([25,22,19,16,13,10,7,4,1],this),this.middle.name="middle",this.right=new ERNO.Slice([2,11,20,5,14,23,8,17,26],this),this.right.name="right",this.right.neighbour=this.middle,this.left.neighbour=this.middle,this.dleft=new ERNO.Slice([24,21,18,15,12,9,6,3,0,25,22,19,16,13,10,7,4,1],this),this.dleft.name="doubleleft",this.dright=new ERNO.Slice([2,11,20,5,14,23,8,17,26,25,22,19,16,13,10,7,4,1],this),this.dright.name="doubleright",this.up=new ERNO.Slice([18,19,20,9,10,11,0,1,2],this),this.up.name="up",this.equator=new ERNO.Slice([21,22,23,12,13,14,3,4,5],this),this.equator.name="equator",this.down=new ERNO.Slice([8,17,26,7,16,25,6,15,24],this),this.down.name="down",this.down.neighbour=this.equator,this.up.neighbour=this.equator,this.dup=new ERNO.Slice([18,19,20,9,10,11,0,1,2,21,22,23,12,13,14,3,4,5],this),this.dup.name="doubleup",this.ddown=new ERNO.Slice([8,17,26,7,16,25,6,15,24,21,22,23,12,13,14,3,4,5],this),this.ddown.name="doubledown",this.front=new ERNO.Slice([0,1,2,3,4,5,6,7,8],this),this.front.name="front",this.standing=new ERNO.Slice([9,10,11,12,13,14,15,16,17],this),this.standing.name="standing",this.back=new ERNO.Slice([26,23,20,25,22,19,24,21,18],this),this.back.name="back",this.back.neighbour=this.standing,this.front.neighbour=this.standing,this.dfront=new ERNO.Slice([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],this),this.dfront.name="doublefront",this.dback=new ERNO.Slice([26,23,20,25,22,19,24,21,18,9,10,11,12,13,14,15,16,17],this),this.dback.name="doubleback",this.faces=[this.front,this.up,this.right,this.down,this.left,this.back],this.slices=[this.left,this.middle,this.right,this.down,this.equator,this.up,this.back,this.standing,this.front];var c=function(t){this.dispatchEvent({type:"onTwistComplete",slice:t.target})}.bind(this);this.slices.forEach(function(t){t.addEventListener("change",c)});var h=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26];this.slicesDictionary={f:this.front,s:this.standing,b:this.back,u:this.up,e:this.equator,d:this.down,r:this.right,m:this.middle,l:this.left,a:this.dleft,c:this.dright,g:this.dup,h:this.ddown,i:this.dfront,j:this.dback,x:new ERNO.Slice(h,this),y:new ERNO.Slice(h,this),z:new ERNO.Slice(h,this)},this.slicesDictionary.x.ableToHideInternalFaces=!1,this.slicesDictionary.y.ableToHideInternalFaces=!1,this.slicesDictionary.z.ableToHideInternalFaces=!1,this.slicesDictionary.x.axis.set(-1,0,0),this.slicesDictionary.y.axis.set(0,-1,0),this.slicesDictionary.z.axis.set(0,0,-1),this.cubelets.forEach(function(t,e){t.setAddress(e)}),this.renderer=e(this.cubelets,this),this.domElement=this.renderer.domElement,this.domElement.classList.add("cube"),this.domElement.style.fontSize=this.cubeletSize+"px",this.autoRotateObj3D.add(this.object3D),this.hideInvisibleFaces&&this.hideIntroverts(null,!0),this.mouseInteraction=new ERNO.Interaction(this,this.camera,this.domElement),this.mouseInteraction.enabled=this.mouseControlsEnabled,this.mouseInteraction.addEventListener("click",function(t){this.dispatchEvent({type:"click",cubelet:t.cubelet,face:t.face})}.bind(this)),this.controls=new(t.controls||ERNO.Controls)(this,this.camera,this.domElement),this.controls.enabled=this.mouseControlsEnabled,this.folds=[new ERNO.Fold(this.front,this.right),new ERNO.Fold(this.left,this.up),new ERNO.Fold(this.down,this.back)],this.setSize(400,200),this.loop=this.loop.bind(this),requestAnimationFrame(this.loop),document.addEventListener("keypress",function(t){if("input"!==t.target.tagName.toLowerCase()&&"textarea"!==t.target.tagName.toLowerCase()&&!this.mouseInteraction.active&&this.keyboardControlsEnabled){var e=String.fromCharCode(t.which);"XxRrMmLlYyUuEeDdZzFfSsBbAaCcGgHhIiJj".indexOf(e)>=0&&this.twist(e)}}.bind(this))},ERNO.Cube.prototype=Object.create(ERNO.Group.prototype),ERNO.Cube.prototype.constructor=ERNO.Cube,ERNO.extend(ERNO.Cube.prototype,{shuffle:function(t,e){t=t||30,e=e||"";var i,n,s=this.shuffleMethod.slice(),o=new ERNO.Twist,r=e.length,a=0;for(this.twistQueue.empty(!0),this.historyQueue.empty(!0);t-- >0;){if(e)i.set(e[a]),a=(a+1)%r;else for(n=s.split(""),i=(new ERNO.Twist).copy(o);i.equals(o);)i.set(n.splice(Math.floor(Math.random()*n.length),1)[0]);i.isShuffle=!0,this.twist(i),o=i.getInverse()}this.finalShuffle=i},solve:function(){this.isSolving=!0},isSolved:function(){return this.front.isSolved(ERNO.Direction.FRONT)&&this.up.isSolved(ERNO.Direction.UP)&&this.right.isSolved(ERNO.Direction.RIGHT)&&this.down.isSolved(ERNO.Direction.DOWN)&&this.left.isSolved(ERNO.Direction.LEFT)&&this.back.isSolved(ERNO.Direction.BACK)},undo:function(){this.twistQueue.history.length>0&&(this.historyQueue.add(this.twistQueue.undo().getInverse()),this.undoing=!0)},redo:function(){this.twistQueue.future.length>0&&(this.undoing=!0,this.historyQueue.empty(),this.historyQueue.add(this.twistQueue.redo()))},twist:function(t){this.undoing&&this.twistQueue.empty(),this.historyQueue.empty(),this.undoing=!1,this.twistQueue.add(t)},immediateTwist:function(t){this.verbosity>=.8&&console.log("Executing a twist command to rotate the "+t.group+" "+t.wise+" by",t.degrees,"degrees.");for(var e,i=this.slicesDictionary[t.command.toLowerCase()],n=(void 0===t.degrees?90:t.degrees)*t.vector,s=n.degreesToRadians(),o=Math.abs(s-i.rotation)/(.5*Math.PI)*this.twistDuration,r=i.indices.length;r-- >0;)i.getCubelet(r).isTweening=!0;new TWEEN.Tween(i).to({rotation:s},o).easing(TWEEN.Easing.Quartic.Out).onComplete(function(){for(i.rotation=s,i.axis.rotation=0,r=i.indices.length;r-- >0;)e=i.getCubelet(r),e.isTweening=!1,e.updateMatrix(),e.matrixSlice.copy(e.matrix);0!==n&&(i.rotateGroupMappingOnAxis(s),this.dispatchEvent({type:"onTwistComplete",slice:i,twist:t})),t===this.finalShuffle&&(this.finalShuffle=null,this.dispatchEvent({type:"onShuffleComplete",slice:i,twist:t}))}.bind(this)).start(this.time)},getText:function(t){return void 0===t?[this.folds[0].getText(),this.folds[1].getText(),this.folds[2].getText()]:_.isNumeric(t)&&t>=0&&t<=2?this.folds[t].getText():void 0},setText:function(t,e){void 0===e?(this.folds[0].setText(t),this.folds[1].setText(t),this.folds[2].setText(t)):_.isNumeric(e)&&e>=0&&e<=2&&this.folds[e].setText(t)},setSize:function(t,e){this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e)},PRESERVE_LOGO:"RrLlUuDdSsBb",ALL_SLICES:"RrMmLlUuEeDdFfSsBb",EVERYTHING:"XxRrMmLlYyUuEeDdZzFfSsBb",loop:function(){var t=0;return function(){if(!this.paused){requestAnimationFrame(this.loop);var e="undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),i=e-(t||e);if(t=e,this.time+=i,TWEEN.update(this.time),this.autoRotate&&(this.rotation.x+=this.rotationDelta.x,this.rotation.y+=this.rotationDelta.y,this.rotation.z+=this.rotationDelta.z),this.isReady&&0===this.isTweening()){var n=this.undoing?this.historyQueue:this.twistQueue;if(0===n.future.length){if(this.isSolving&&window.solver)this.isSolving=window.solver.consider(this);else if(this.taskQueue.isReady===!0){var s=this.taskQueue.do();s instanceof Function&&s()}}else{var o=n.do();"x"!==o.command.toLowerCase()&&"y"!==o.command.toLowerCase()&&"z"!==o.command.toLowerCase()&&0!==o.degrees&&(this.moveCounter+=this.undoing?-1:1),(0===o.degrees||o.isShuffle)&&n.purge(o),this.immediateTwist(o)}}this.mouseInteraction.enabled=this.mouseControlsEnabled&&!this.finalShuffle,this.mouseInteraction.update(),this.controls.enabled=this.mouseControlsEnabled&&!this.mouseInteraction.active,this.controls.update()}}}(),pause:function(){this.paused=!0},resume:function(){this.paused=!1,requestAnimationFrame(this.loop)}}),ERNO.Solver=function(){this.logic=function(t){return!1}},ERNO.Solver.prototype.consider=function(t){return void 0===t?(console.warn("A cube [Cube] argument must be specified for Solver.consider()."),!1):t instanceof ERNO.Cube==!1?(console.warn("The cube argument provided is not a valid Cube."),!1):(t.isShuffling=!1,t.isSolved()?(ERNO.Solver.prototype.explain("I’ve found that the cube is already solved."),!1):this.logic(t))},ERNO.Solver.prototype.hint=function(t){console.log("%c"+t+"%c\n","background-color: #EEE; color: #333","")},ERNO.Solver.prototype.explain=function(t){console.log("Solver says: %c "+t+" %c\n","color: #080","")};var SceneType=THREE.Scene;THREE.Scene=SceneType||function(){},ERNO.renderers=ERNO.renderers||{},ERNO.renderers.CSS3D=function(t,e){function i(t){t.style.display="block"}function n(t){t.style.display="none"}function s(){return Array.prototype.slice.call(a.domElement.querySelectorAll(".faceLabel"))}function o(t){t instanceof THREE.CSS3DObject&&(t.element.style.WebkitTransformStyle="preserve-3d",t.element.style.MozTransformStyle="preserve-3d",t.element.style.oTransformStyle="preserve-3d",t.element.style.transformStyle="preserve-3d");for(var e=0,i=t.children.length;e<i;e++)o(t.children[e])}function r(){if(e.domElement.parentNode){var t=e.domElement.parentNode.clientWidth,i=e.domElement.parentNode.clientHeight;!e.domElement.parentNode||e.domElement.clientWidth===t&&e.domElement.clientHeight===i||(e.setSize(t,i),o(c)),a.render(c,e.camera)}requestAnimationFrame(r)}var a=new THREE.CSS3DRenderer,c=new THREE.Object3D;a.scene=c,c.add(e.autoRotateObj3D),c.add(e.camera);var h;new THREE.Vector3;return e.faces.forEach(function(t,i){h=e[t.face].label=new THREE.CSS3DObject(document.createElement("div")),h.element.classList.add("faceLabel"),h.position.copy(t.axis).multiplyScalar(e.size),h.position.negate(),h.element.innerHTML=t.face.toUpperCase(),e.object3D.add(h)}),e.right.label.rotation.y=.5*Math.PI,e.left.label.rotation.y=Math.PI*-.5,e.back.label.rotation.y=Math.PI,e.up.label.rotation.x=Math.PI*-.5,e.down.label.rotation.x=.5*Math.PI,e.showFaceLabels=function(){return s().forEach(i),this.showingFaceLabels=!0,this},e.hideFaceLabels=function(){return s().forEach(n),this.showingFaceLabels=!1,this},ERNO.extend(ERNO.Cubelet.prototype,ERNO.renderers.CSS3DCubelet.methods),t.forEach(ERNO.renderers.CSS3DCubelet),requestAnimationFrame(r),SceneType&&(THREE.Scene=SceneType),a},ERNO.renderers.CSS3DCubelet=function(){return function(t){var e=document.createElement("div");e.classList.add("cubelet"),e.classList.add("cubeletId-"+t.cubeletId),t.css3DObject=new THREE.CSS3DObject(e),t.css3DObject.name="css3DObject-"+t.cubeletId,t.add(t.css3DObject);var i=t.size/2,n=["rotateX(   0deg ) translateZ( "+i+"px ) rotateZ(   0deg )","rotateX(  90deg ) translateZ( "+i+"px ) rotateZ(   0deg )","rotateY(  90deg ) translateZ( "+i+"px ) rotateZ(   0deg )","rotateX( -90deg ) translateZ( "+i+"px ) rotateZ(  90deg )","rotateY( -90deg ) translateZ( "+i+"px ) rotateZ( -90deg )","rotateY( 180deg ) translateZ( "+i+"px ) rotateZ( -90deg )"],s=["axisZ","axisY","axisX","axisY","axisX","axisZ"];t.faces.forEach(function(e){e.element=document.createElement("div"),e.element.classList.add("face"),e.element.classList.add(s[e.id]),e.element.classList.add("face"+ERNO.Direction.getNameById(e.id).capitalize()),t.css3DObject.element.appendChild(e.element);var i=document.createElement("div");i.classList.add("wireframe"),e.element.appendChild(i);var o=document.createElement("div");o.classList.add("id"),e.element.appendChild(o);var r=document.createElement("span");r.classList.add("underline"),r.innerText=t.cubeletId,o.appendChild(r);var a=n[e.id],c=e.element.style;if(c.OTransform=c.MozTransform=c.WebkitTransform=c.transform=a,e.isIntrovert)e.element.classList.add("faceIntroverted"),e.element.appendChild(document.createElement("div"));else{e.element.classList.add("faceExtroverted");var h=document.createElement("div");h.classList.add("sticker"),h.classList.add(e.color.name),e.element.appendChild(h),t.isStickerCubelet&&h.classList.add("stickerLogo");var u=document.createElement("div");u.classList.add("text"),u.innerText=e.id,e.text=u,e.element.appendChild(u)}}),t.show(),t.showIntroverts(),t.showPlastics(),t.showStickers(),t.hideIds(),t.hideTexts(),t.hideWireframes()}}(),ERNO.renderers.CSS3DCubelet.methods=function(){function t(t){t.style.display="block"}function e(t){t.style.display="none"}return{getFaceElements:function(t){var e=t||"";return Array.prototype.slice.call(this.css3DObject.element.querySelectorAll(".face"+e))},show:function(){t(this.css3DObject.element),this.showing=!0},hide:function(){e(this.css3DObject.element),this.showing=!1},showExtroverts:function(){this.getFaceElements(".faceExtroverted").forEach(t),this.showingExtroverts=!0},hideExtroverts:function(){this.getFaceElements(".faceExtroverted").forEach(e),this.showingExtroverts=!1},showIntroverts:function(){var e,i=new THREE.Vector3,n=new THREE.Matrix4;return function(s,o){e="",s&&(n.getInverse(this.matrix),i.copy(s).transformDirection(n),e=1===Math.abs(Math.round(i.x))?".axisX":1===Math.round(Math.abs(i.y))?".axisY":".axisZ"),this.getFaceElements(".faceIntroverted"+(void 0!==s?e:"")).forEach(t),o||(this.showingIntroverts=!0)}}(),hideIntroverts:function(){var t,i=new THREE.Vector3,n=new THREE.Matrix4;return function(s,o){t="",s&&(n.getInverse(this.matrix),i.copy(s).transformDirection(n),t=1===Math.abs(Math.round(i.x))?".axisX":1===Math.round(Math.abs(i.y))?".axisY":".axisZ"),this.getFaceElements(".faceIntroverted"+(void 0!==s?t:"")).forEach(e),o||(this.showingIntroverts=!1)}}(),showPlastics:function(){this.getFaceElements().forEach(function(t){t.classList.remove("faceTransparent")}),this.showingPlastics=!0},hidePlastics:function(){this.getFaceElements().forEach(function(t){t.classList.add("faceTransparent")}),this.showingPlastics=!1},hideStickers:function(){this.getFaceElements(" .sticker").forEach(e),this.showingStickers=!1},showStickers:function(){this.getFaceElements(" .sticker").forEach(t),this.showingStickers=!0},showWireframes:function(){this.getFaceElements(" .wireframe").forEach(t),this.showingWireframes=!0},hideWireframes:function(){this.getFaceElements(" .wireframe").forEach(e),this.showingWireframes=!1},showIds:function(){this.getFaceElements(" .id").forEach(t),this.showingIds=!0},hideIds:function(){this.getFaceElements(" .id").forEach(e),this.showingIds=!1},showTexts:function(){this.getFaceElements(" .text").forEach(t),this.showingTexts=!0},hideTexts:function(){this.getFaceElements(" .text").forEach(e),this.showingTexts=!1},getOpacity:function(){return this.opacity},setOpacity:function(t,e){if(this.opacityTween&&this.opacityTween.stop(),void 0===t&&(t=1),t!==this.opacity){var i=this,n=(t-this.opacity).absolute().scale(0,1,0,200);this.opacityTween=new TWEEN.Tween({opacity:this.opacity}).to({opacity:t},n).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){i.css3DObject.element.style.opacity=this.opacity,i.opacity=this.opacity}).onComplete(function(){e instanceof Function&&e()}).start()}},getStickersOpacity:function(t){return parseFloat(this.getFaceElements(" .sticker")[0].style.opacity)},setStickersOpacity:function(t){void 0===t&&(t=.2);var e=t;this.getFaceElements(" .sticker").forEach(function(t){t.style.opacity=e.toString()})}}}();